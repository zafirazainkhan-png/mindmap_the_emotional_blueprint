<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Why am I feeling?</title>

  <style>
    :root {
      --teal: #007f7f;
      --teal-soft: #5eaaa8;
      --bg-start: #fefcf9;
      --bg-end: #eafaf9;
      --text-color: #233;
      --topbar-bg: #fff;
      --topbar-border: #5eaaa8;
      --speech-bubble-bg: #fffdf7;
      --speech-bubble-border: #5eaaa8;
      --speech-bubble-text: #1f2f2f;
      --cta-bg: #007f7f;
      --cta-hover-bg: #5eaaa8;
      --cta-text: #fff;
      --footer-bg: rgba(255, 255, 255, 0.95);
      --footer-bg-end: rgba(255, 255, 255, 0.92);
      --footer-border: rgba(0, 0, 0, 0.04);
      --dot-bg: #fff;
      --dot-text: #007f7f;
      --dot-active-bg: #007f7f;
      --dot-active-text: #fff;
      --dot-label-text: #2f4f4f;
      --spinner-bg: rgba(0, 0, 0, 0.5);
      --spinner-border: #f3f3f3;
      --dock-h: 60px;
    }

    [data-theme="dark"] {
      --bg-start: #1a1a1a;
      --bg-end: #2c3e50;
      --text-color: #e0e0e0;
      --topbar-bg: #2d2d2d;
      --topbar-border: #4a6060;
      --speech-bubble-bg: #333333;
      --speech-bubble-border: #4a6060;
      --speech-bubble-text: #d0d0d0;
      --cta-bg: #4a6060;
      --cta-hover-bg: #6b8e8e;
      --cta-text: #e0e0e0;
      --footer-bg: rgba(45, 45, 45, 0.95);
      --footer-bg-end: rgba(45, 45, 45, 0.92);
      --footer-border: rgba(255, 255, 255, 0.1);
      --dot-bg: #2d2d2d;
      --dot-text: #e0e0e0;
      --dot-active-bg: #4a6060;
      --dot-active-text: #e0e0e0;
      --dot-label-text: #b0b0b0;
      --spinner-bg: rgba(0, 0, 0, 0.7);
      --spinner-border: #666666;
    }

    html, body {
      height: 100%;
      margin: 0;
    }
    body {
      font-family: "Segoe UI", system-ui, -apple-system, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, var(--bg-start), var(--bg-end));
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .top-dock {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem;
      background: var(--topbar-bg);
      border-bottom: 2px solid var(--topbar-border);
      position: sticky;
      top: 0;
      z-index: 10;
      width: 100%;
      height: var(--dock-h);
    }

    .dark-mode-btn {
      font-size: 20px;
      padding: 5px;
      border: none;
      background: none;
      color: var(--teal);
      cursor: pointer;
      transition: color 0.3s;
    }
    .dark-mode-btn:hover {
      color: var(--cta-text);
    }

    .header-visual img {
      width: 40px;
      height: auto;
      vertical-align: middle;
    }

    .nav-links {
      display: flex;
      gap: 15px;
      align-items: center;
    }
    .nav-links a {
      text-decoration: none;
      color: var(--teal);
      font-weight: 600;
      padding: 0.3rem 0.8rem;
      border-radius: 15px;
      transition: background 0.3s, color 0.3s;
    }
    .nav-links a.active {
      background: var(--teal);
      color: var(--cta-text);
    }
    .nav-links a:hover {
      background: var(--teal-soft);
      color: var(--cta-text);
    }

    .audio-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .audio-controls #volume {
      width: 80px;
    }
    .audio-controls button {
      font-size: 18px;
      padding: 3px;
      border: none;
      background: none;
      color: var(--teal);
      cursor: pointer;
      transition: color 0.3s;
    }
    .audio-controls button:hover {
      color: var(--cta-text);
    }

    .hero {
      width: 100%;
      max-width: 1100px;
      padding: 32px 20px 8px;
      text-align: center;
    }
    .hero h1 {
      margin: 0;
      color: var(--teal);
      font-size: 40px;
      line-height: 1;
      letter-spacing: 0.4px;
    }
    .hero .tagline {
      margin-top: 8px;
      font-style: italic;
      color: var(--dot-label-text);
      font-size: 18px;
    }

    .speech-bubble {
      width: calc(100% - 120px);
      max-width: 960px;
      margin: 22px auto;
      padding: 22px;
      background: var(--speech-bubble-bg);
      border-radius: 14px;
      border: 3px solid var(--speech-bubble-border);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.06);
      text-align: left;
      min-height: 110px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #typewriter {
      width: 100%;
      font-family: "Courier New", Courier, monospace;
      font-size: 17px;
      color: var(--speech-bubble-text);
      line-height: 1.5;
      white-space: pre-wrap;
      word-break: break-word;
      border-right: 3px solid var(--speech-bubble-border);
      padding-right: 6px;
      box-sizing: border-box;
    }

    .swirl-visual {
      margin: 14px 0 6px;
    }
    #brainImage {
      width: 150px;
      display: block;
      margin: 12px auto;
      transform-origin: center center;
      animation: swirlGrow 1000ms ease-in-out forwards;
      z-index: 10;
    }
    @keyframes swirlGrow {
      0% {
        transform: scale(0.6) rotate(0deg);
        opacity: 0.6;
      }
      55% {
        transform: scale(1.25) rotate(210deg);
        opacity: 1;
      }
      100% {
        transform: scale(1.5) rotate(360deg);
        opacity: 1;
      }
    }
    .zoom-effect {
      animation: zoomToFull 1000ms cubic-bezier(0.2, 0.9, 0.25, 1) forwards;
      z-index: 1000;
      position: relative;
    }
    @keyframes zoomToFull {
      from {
        transform: scale(1.5) rotate(0deg);
        opacity: 1;
      }
      to {
        transform: scale(3.4) rotate(720deg);
        opacity: 0;
      }
    }

    .cta-wrap {
      margin: 18px 0 24px;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .cta-button {
      padding: 12px 26px;
      border-radius: 34px;
      background: var(--cta-bg);
      color: var(--cta-text);
      border: 0;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(0, 127, 127, 0.12);
      transition: transform 0.14s ease, background 0.18s ease;
      position: relative;
      z-index: 1200;
      display: inline-block;
    }
    .cta-button:hover {
      transform: translateY(-3px);
      background: var(--cta-hover-bg);
    }
    .cta-button:disabled {
      opacity: 0.85;
      cursor: not-allowed;
    }

    main.container {
      padding-bottom: calc(var(--dock-h) + 28px);
    }

    .progress-dock {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      justify-content: center;
      gap: 20px;
      padding: 10px;
      background: var(--footer-bg);
      border-top: 1px solid var(--footer-border);
      z-index: 60;
    }
    .progress-dock .step {
      text-decoration: none;
      color: var(--dot-text);
      font-weight: bold;
      font-size: 18px;
      padding: 5px 10px;
      border-radius: 50%;
      background: var(--dot-bg);
      transition: background 0.3s, color 0.3s;
    }
    .progress-dock .step.active {
      background: var(--dot-active-bg);
      color: var(--dot-active-text);
    }
    .progress-dock .step:hover {
      background: var(--teal-soft);
      color: var(--cta-text);
    }

    .loading {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--spinner-bg);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1100;
    }
    .spinner {
      border: 4px solid var(--spinner-border);
      border-top: 4px solid var(--teal);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 760px) {
      .hero h1 {
        font-size: 28px;
      }
      #brainImage {
        width: 120px;
      }
      .speech-bubble {
        margin: 14px 10px;
        padding: 16px;
        min-height: 100px;
      }
      .top-dock {
        flex-direction: column;
        padding: 5px;
      }
      .nav-links {
        margin: 5px 0;
      }
      .audio-controls {
        margin-top: 5px;
      }
      .progress-dock {
        gap: 10px;
        padding: 5px;
      }
      .progress-dock .step {
        font-size: 16px;
        padding: 3px 8px;
      }
    }
  </style>
</head>
<body>
  <header class="top-dock">
    <button id="darkModeToggle" class="dark-mode-btn">ðŸŒ™</button>
    <div class="header-visual">
      <img src="{{ url_for('static', filename='header-illustration.png') }}" alt="">
    </div>
    <div class="nav-links">
      <a href="{{ url_for('homepage') }}">Home</a>
      <a href="{{ url_for('why_am_i_feeling') }}" class="active">Why am I feeling?</a>
      <a href="{{ url_for('what_am_i_feeling') }}">What am I feeling?</a>
      <a href="{{ url_for('managing_emotions') }}">Managing emotions</a>
      <a href="{{ url_for('mood_messengers') }}">Mood Messengers</a>
    </div>
    <div class="audio-controls">
      <audio id="bg-music" autoplay loop>
        <source src="{{ url_for('static', filename='background.mp3') }}" type="audio/mpeg">
      </audio>
      <input type="range" id="volume" min="0" max="1" step="0.01" value="0.5">
      <button id="muteBtn">ðŸ”Š</button>
    </div>
  </header>

  <main class="container" style="width: 100%; max-width: 1100px;">
    <section class="hero">
      <h1>Welcome to MindMap</h1>
      <div class="tagline">Here to understand your emotions? Let's take a calm journey through your brain.</div>
    </section>

    <section aria-live="polite">
      <div class="speech-bubble" role="status">
        <div id="typewriter"></div>
      </div>

      <div class="swirl-visual">
        <img id="brainImage" src="{{ url_for('static', filename='simulator_home_page.png') }}" alt="Swirling brain (amygdala)" loading="lazy">
      </div>

      <div class="cta-wrap">
        <button id="zoomBtn" class="cta-button" aria-label="Continue to amygdala">Click to Continue With the Experience</button>
      </div>
    </section>
  </main>

  <footer class="progress-dock">
    <a href="{{ url_for('amygdala') }}" class="step active">1</a>
    <a href="{{ url_for('hippocampus') }}" class="step">2</a>
    <a href="{{ url_for('hypothalamus') }}" class="step">3</a>
    <a href="{{ url_for('thalamus') }}" class="step">4</a>
    <a href="{{ url_for('cingulate_gyrus') }}" class="step">5</a>
  </footer>

  <div id="loading" class="loading" style="display: none;">
    <div class="spinner"></div>
  </div>

  <script>
    (function() {
      const toggleButton = document.getElementById('darkModeToggle');
      const html = document.documentElement;

      // Apply saved theme on load
      const savedTheme = localStorage.getItem('theme') || 'light';
      html.setAttribute('data-theme', savedTheme);

      toggleButton.addEventListener('click', () => {
        const isDark = html.getAttribute('data-theme') === 'dark';
        html.setAttribute('data-theme', isDark ? 'light' : 'dark');
        localStorage.setItem('theme', isDark ? 'light' : 'dark');
      });
    })();

    (function() {
      const audio = document.getElementById('bg-music');
      const volumeControl = document.getElementById('volume');
      const muteBtn = document.getElementById('muteBtn');

      // Load saved audio state
      const savedVolume = localStorage.getItem('volume') || 0.5;
      const savedMuted = localStorage.getItem('muted') === 'true';
      const savedTime = localStorage.getItem('musicTime') || 0;

      audio.volume = savedVolume;
      audio.muted = savedMuted;
      audio.currentTime = savedTime;
      if (!savedMuted) audio.play().catch(e => console.log('Audio play failed:', e));
      muteBtn.textContent = savedMuted ? 'ðŸ”‡' : 'ðŸ”Š';

      volumeControl.value = savedVolume;
      volumeControl.addEventListener('input', (e) => {
        audio.volume = e.target.value;
        localStorage.setItem('volume', e.target.value);
      });

      muteBtn.addEventListener('click', () => {
        audio.muted = !audio.muted;
        muteBtn.textContent = audio.muted ? 'ðŸ”‡' : 'ðŸ”Š';
        localStorage.setItem('muted', audio.muted);
        if (!audio.muted) audio.play().catch(e => console.log('Audio play failed:', e));
      });

      // Save audio state beforeunload
      window.addEventListener('beforeunload', () => {
        localStorage.setItem('volume', audio.volume);
        localStorage.setItem('muted', audio.muted);
        if (!audio.paused) localStorage.setItem('musicTime', audio.currentTime);
      });
    })();

    document.addEventListener('DOMContentLoaded', () => {
      const el = document.getElementById('typewriter');
      const text = "Did you know that a part of your brain called the limbic system plays a big role in how you feel?\nIt helps control emotions like happiness, fear, sadness, and excitement. In this web app you will be exploring five key regions of the limbic system to see how they shape your feelings.";
      let i = 0;
      const speed = 28;
      function step() {
        i++;
        el.textContent = text.slice(0, i);
        if (i <= text.length) {
          setTimeout(step, speed);
        } else {
          el.style.borderRight = '0';
        }
      }
      setTimeout(step, 180);
    });

    (function() {
      const btn = document.getElementById('zoomBtn');
      const img = document.getElementById('brainImage');
      const loading = document.getElementById('loading');
      if (!btn || !img || !loading) return;

      img.style.animation = 'none';
      img.offsetHeight;
      img.style.animation = 'swirlGrow 1000ms ease-in-out forwards';

      btn.addEventListener('click', () => {
        btn.disabled = true;
        btn.style.opacity = '0.85';
        img.classList.add('zoom-effect');
        setTimeout(() => {
          loading.style.display = 'flex';
        }, 600);
        setTimeout(() => {
          window.location.href = "{{ url_for('amygdala') | safe }}";
        }, 1000);
      });
    })();
  </script>
</body>
</html>